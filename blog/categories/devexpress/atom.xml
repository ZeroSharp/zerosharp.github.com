<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: devexpress | ZeroSharp]]></title>
  <link href="http://ZeroSharp.github.com/blog/categories/devexpress/atom.xml" rel="self"/>
  <link href="http://ZeroSharp.github.com/"/>
  <updated>2014-10-08T16:26:13+01:00</updated>
  <id>http://ZeroSharp.github.com/</id>
  <author>
    <name><![CDATA[Robert Anderson]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ELMAH with DevExpress XAF]]></title>
    <link href="http://ZeroSharp.github.com/elmah-with-devexpress-xaf/"/>
    <updated>2014-10-08T15:45:00+01:00</updated>
    <id>http://ZeroSharp.github.com/elmah-with-devexpress-xaf</id>
    <content type="html"><![CDATA[<p><a href="https://code.google.com/p/elmah/">ELMAH (Error Logging Modules and Handlers)</a> is an open source library for logging unhandled exceptions. This post explains how to get it running with the <a href="https://www.devexpress.com/Products/NET/Application_Framework/">DevExpress XAF</a> main demo.</p>

<p>A couple of amazing facts about ELMAH.</p>

<ul>
<li>It has been around since 2004!</li>
<li>It was written by <a href="http://www.raboof.com/">Atif Aziz</a> who happens to be an old school-friend from the International School of Geneva.</li>
</ul>


<p>XAF provides <a href="https://documentation.devexpress.com/#xaf/CustomDocument2704">quite extensive error handling options</a> out of the box, but I have found Elmah better suited to production environments because of the ability to remotely view the full error log.</p>

<h2>Setting up</h2>

<p>First, get the ELMAH package via NuGet into the MainDemo.Web project. ELMAH provides dozens of different methods of persisting the error log. For this example we'll choose one of the simplest. Make sure you select the <em>ELMAH on XML Log</em> package.</p>

<p><img src="/images/blog/xaf-with-elmah-001.png"></p>

<p>NuGet makes several automatic modifications to the <em>web.config</em>. Unfortunately, these are not quite accurate enough for XAF. The changes you need to make are detailed below:</p>

<p>Add a <code>&lt;configSection&gt;</code> for ELMAH as alongside the existing devExpress one.</p>

<p>```xml web.config
  <configSections></p>

<pre><code>&lt;sectionGroup name="devExpress"&gt;...&lt;/sectionGroup&gt; &lt;!-- this should already exist--&gt;
&lt;sectionGroup name="elmah"&gt; &lt;!-- this is new--&gt;
  &lt;section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah" /&gt;
  &lt;section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah" /&gt;
  &lt;section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah" /&gt;
  &lt;section name="errorFilter" requirePermission="false" type="Elmah.ErrorFilterSectionHandler, Elmah" /&gt;
 &lt;/sectionGroup&gt;
</code></pre>

<p>  </configSections>
```</p>

<p>Your <code>&lt;system.webServer&gt;</code> section should look like this:</p>

<p>```xml web.config
  &lt;system.webServer></p>

<pre><code>&lt;handlers&gt;...&lt;/handlers&gt; &lt;!-- This is unchanged --&gt;
&lt;validation validateIntegratedModeConfiguration="false" /&gt;
&lt;modules&gt;
  &lt;add name="ASPxHttpHandlerModule" type="DevExpress.Web.ASPxClasses.ASPxHttpHandlerModule, DevExpress.Web.v14.1, Version=14.1.7.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" preCondition="managedHandler" /&gt;
  &lt;add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" preCondition="managedHandler" /&gt;
  &lt;add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler" /&gt;
&lt;/modules&gt;
</code></pre>

<p>  &lt;/system.webServer>
```</p>

<p>Add a <code>&lt;location&gt;</code> for the path <em>elmah.axd</em> (alongside the existing <code>&lt;location&gt;</code> tags).</p>

<p>```xml web.config
  <location path="elmah.axd" inheritInChildApplications="false"></p>

<pre><code>&lt;system.web&gt;
  &lt;httpHandlers&gt;
    &lt;add verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah" /&gt;
  &lt;/httpHandlers&gt;
  &lt;!-- 
    See http://code.google.com/p/elmah/wiki/SecuringErrorLogPages for 
    more information on using ASP.NET authorization securing ELMAH.

  &lt;authorization&gt;
    &lt;allow roles="admin" /&gt;
    &lt;deny users="*" /&gt;  
  &lt;/authorization&gt;
  --&gt;  
&lt;/system.web&gt;
&lt;system.webServer&gt;
  &lt;handlers&gt;
    &lt;add name="ELMAH" verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah" preCondition="integratedMode" /&gt;
  &lt;/handlers&gt;
&lt;/system.webServer&gt;
</code></pre>

<p>  </location>
```</p>

<p>Add a new <code>&lt;elmah&gt;</code> section. I put mine just before the final <code>&lt;/configuration&gt;</code> tag.</p>

<p>```xml web.config
  <elmah></p>

<pre><code>&lt;errorLog type="Elmah.XmlFileErrorLog, Elmah" logPath="~/App_Data/Elmah.Errors" /&gt;
&lt;!--
    See http://code.google.com/p/elmah/wiki/SecuringErrorLogPages for 
    more information on remote access and securing ELMAH.
--&gt;
&lt;security allowRemoteAccess="false" /&gt;
</code></pre>

<p>  </elmah>
```</p>

<p>Now modify <em>HttpModules.Web.Config</em> to look like this:</p>

<p><code>xml HttpModules.Web.Config
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;httpModules&gt;
  &lt;add name="ASPxHttpHandlerModule" type="DevExpress.Web.ASPxClasses.ASPxHttpHandlerModule, DevExpress.Web.v14.1, Version=14.1.7.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" /&gt;
  &lt;add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" /&gt;
  &lt;add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" /&gt;
&lt;/httpModules&gt;
</code></p>

<p>Now we need to extend XAF's standard error handling. Create a new class in the web application.</p>

<p>```c#
public class ElmahErrorHandling : ErrorHandling
{</p>

<pre><code>protected override void LogException(ErrorInfo errorInfo)
{
    base.LogException(errorInfo);

    if (errorInfo.Exception != null)
        Elmah.ErrorSignal.FromCurrentContext().Raise(errorInfo.Exception);
}
</code></pre>

<p>}
```</p>

<p>And then modify <em>Global.asax.cs</em> to instantiate the new class</p>

<p>```c#</p>

<pre><code>    protected void Application_Start(object sender, EventArgs e) {
        ErrorHandling.Instance = new ElmahErrorHandling(); // &lt;---this line is new
        ASPxWebControl.CallbackError += new EventHandler(Application_Error);
</code></pre>

<h1>if DEBUG</h1>

<pre><code>        TestScriptsManager.EasyTestEnabled = true;
</code></pre>

<h1>endif</h1>

<pre><code>    }
</code></pre>

<p>```</p>

<p>The complete files are available with the <a href="https://github.com/ZeroSharp/Xaf_MainDemo_Elmah">source code</a>.</p>

<p>Now run the application and trigger an unhandled exception. Change the URL to something that does not exist. Or open any detail view and modify the URL so that the Guid in the <em>ShortcutObjectKey</em> is invalid (replace a digit with an 'X'). Then the application error page appears.</p>

<p><img src="/images/blog/xaf-with-elmah-002.png"></p>

<p>Then return to the application and change the URL to <code>Elmah.axd</code>. You are looking at the log of all unhandled exceptions.</p>

<p><img src="/images/blog/xaf-with-elmah-003.png"></p>

<p>And for each exception, you can view the full details of any logged exception including coloured stack trace and full server variables.</p>

<p><img src="/images/blog/xaf-with-elmah-004.png"></p>

<h2>ELMAH options</h2>

<p>By default, ELMAH is configured to disallow remote access to the error logs -  only a local user can get to <em>elmah.axd</em>. If you take care of the security implications it can be very useful to enable remote access and  monitor the logs on your production servers.</p>

<p>We chose to use an XML file for each error but ELMAH is entirely pluggable. There are dozens of alternatives for persisting the error log including Sql Server, an RSS feeds, to Twitter, even to <a href="http://code.google.com/p/elmah/wiki/ProwlingErrors">an iPhone app</a>. There are even third party sites such as <a href="http://elmah.io">elmah.io</a> who will host your error logs for you.</p>

<p>One of the advantages of using XML files is that the files can be copied to another machine. If you look in <em>MainDemo.Web\App_Data\Elmah.Errors</em>, you will find the resulting xml files.</p>

<p><img src="/images/blog/xaf-with-elmah-005.png"></p>

<p>You can just copy these files to another installation's <em>Elmah.Errors</em> folder and the log will show up when you visit <em>Elmah.axd</em>.</p>

<p>One final note. ELMAH was developed for ASP.NET applications and web services, but it is possible to get it to work with other types of applications such as Windows Forms, Windows Service or console applications. Check out <a href="https://stackoverflow.com/questions/841451/using-elmah-in-a-console-application">this StackOverflow question</a>.</p>

<p>The source code for this example is <a href="https://github.com/ZeroSharp/Xaf_MainDemo_Elmah">on GitHub</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A web UI performance tip for XAF web applications]]></title>
    <link href="http://ZeroSharp.github.com/a-web-ui-performance-tip-for-xaf-web-applications/"/>
    <updated>2014-03-31T10:16:00+01:00</updated>
    <id>http://ZeroSharp.github.com/a-web-ui-performance-tip-for-xaf-web-applications</id>
    <content type="html"><![CDATA[<p>The purpose of this post is to raise your awareness of a toggle which exists in the <a href="http://www.devexpress.com/xaf/">DevExpress XAF framework</a> which can significantly improve UI performance in the web application.</p>

<p><span class='pullquote-right' data-pullquote='In fact the general responsiveness of the entire web-application seems much better.'>
The biggest XAF project I work with has one very complex business object. The layout for this screen includes about 100 properties, several nested tabs, some custom editors, several collection properties and a whole lot of <a href="https://documentation.devexpress.com/#Xaf/CustomDocument3286">Conditional Appearance</a> rules. It was very sluggish to navigate - it was taking several seconds to load the detail view and then it was very slow switching between tabs. Switching to edit mode was also slow.</p>

<p>Last week, I almost accidentally changed the value of <code>DelayedViewItemsInitialization</code> to <code>false</code> and noticed that the UI speed was much much better. In fact the general responsiveness of the entire web-application seems much better.</p>

<p>In order to give it a whirl, navigate to the WebApplication.cs file (normally in the ApplicationCode subfolder of your web project) and modify the constructor as follows:</p>

<p></span></p>

<p>```c#
public MainDemoWebApplication() {</p>

<pre><code>InitializeComponent();
this.DelayedViewItemsInitialization = false;
</code></pre>

<p>}
```</p>

<p>Certainly this is not without consequences, and I would urge a careful reading of the <a href="https://documentation.devexpress.com/#xaf/DevExpressExpressAppXafApplication_DelayedViewItemsInitializationtopic">relevant documentation</a>. To be honest, I still don't really understand why my detail view is so much slower without this change. I have tried to isolate the cause without much success and I will update this post if I find anything new. But if some of your detail views seem overly slow, certainly try it out.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Glimpse with DevExpress XAF]]></title>
    <link href="http://ZeroSharp.github.com/glimpse-with-devexpress-xaf/"/>
    <updated>2013-12-17T12:41:00+00:00</updated>
    <id>http://ZeroSharp.github.com/glimpse-with-devexpress-xaf</id>
    <content type="html"><![CDATA[<p>I have finally got around to getting Glimpse working with XAF. Glimpse is an amazing extensible ASP.NET plug-in which gives you valuable information about what is going on within your server in production. It's also very pretty.</p>

<p>Let's jump right in and have a look at what XAF looks like with Glimpse running.</p>

<p><img src="/images/blog/xaf-with-glimpse-016.png"></p>

<p>That banner along the bottom of the screen is the Glimpse heads up display (HUD). Hovering over various sections of it pops up more information:</p>

<p><img src="/images/blog/xaf-with-glimpse-019.png"></p>

<p><img src="/images/blog/xaf-with-glimpse-018.png"></p>

<p><img src="/images/blog/xaf-with-glimpse-017.png"></p>

<p>If you click on the Glimpse icon in the bottom right, you get even more goodies. Here's the <em>Timeline</em> view.</p>

<p><img src="/images/blog/xaf-with-glimpse-011.png"></p>

<p>And there are many other tabs available. The <em>Configuration</em> tab shows the contents of the <em>web.config</em> file.
<img src="/images/blog/xaf-with-glimpse-009.png">
Here's the <em>Control Tree</em> tab:
<img src="/images/blog/xaf-with-glimpse-010.png">
The <em>Page Life Cycle</em> tab:
<img src="/images/blog/xaf-with-glimpse-005.png">
The <em>Request</em> tab:
<img src="/images/blog/xaf-with-glimpse-004.png">
The <em>Session</em> tab:
<img src="/images/blog/xaf-with-glimpse-003.png">
And the <em>Trace</em> tab including the DevExpress log items that were added to the trace during this page load:
<img src="/images/blog/xaf-with-glimpse-002.png">
As you can see, this is a very valuable glimpse into the server which can be turned on as needed in production.</p>

<h2>Adding Glimpse to an XAF application</h2>

<p>First install the Glimpse Nuget package into the project.</p>

<p><img src="/images/blog/xaf-with-glimpse-001.png"></p>

<p>The Nuget installation will make various incorrect changes to the web.config. The corrected sections are below:</p>

<p>First, add Glimpse to the <code>&lt;configSections&gt;</code>.
```diff web.config
  <configSections></p>

<pre><code>&lt;sectionGroup name="devExpress"&gt;
  &lt;section name="compression" requirePermission="false" type="DevExpress.Web.ASPxClasses.CompressionConfigurationSection, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;section name="themes" type="DevExpress.Web.ASPxClasses.ThemesConfigurationSection, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;section name="settings" type="DevExpress.Web.ASPxClasses.SettingsConfigurationSection, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
&lt;/sectionGroup&gt;
</code></pre>

<ul>
<li><section name="glimpse" type="Glimpse.Core.Configuration.Section, Glimpse.Core" />
</configSections>
```</li>
</ul>


<p>Next, <code>&lt;system.webserver&gt;</code> should look like this:
```diff
  &lt;system.webServer></p>

<pre><code>&lt;handlers&gt;
  &lt;add name="TestControls.axd_*" path="TestControls.axd" verb="*" type="DevExpress.ExpressApp.Web.TestScripts.TestScriptsManager, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, culture=neutral, PublicKeyToken=b88d1754d700e49a" preCondition="integratedMode" /&gt;
  &lt;add name="ImageResource.axd_*" path="ImageResource.axd" verb="*" type="DevExpress.ExpressApp.Web.ImageResourceHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, culture=neutral, PublicKeyToken=b88d1754d700e49a" preCondition="integratedMode" /&gt;
  &lt;add name="SessionKeepAliveReconnectHttpHandler" verb="*" path="SessionKeepAliveReconnect.aspx*" type="DevExpress.ExpressApp.Web.SessionKeepAliveReconnectHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, culture=neutral, PublicKeyToken=b88d1754d700e49a" preCondition="integratedMode" /&gt;
  &lt;add name="WebWindowTemplateHttpHandler" verb="*" path="*.aspx" type="DevExpress.ExpressApp.Web.WebWindowTemplateHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, culture=neutral, PublicKeyToken=b88d1754d700e49a" preCondition="integratedMode" /&gt;
  &lt;add name="ASPxUploadProgressHandler" verb="GET,POST" path="ASPxUploadProgressHandlerPage.ashx" type="DevExpress.Web.ASPxUploadControl.ASPxUploadProgressHttpHandler, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" preCondition="integratedMode" /&gt;
  &lt;add name="ReportExportResource.axd_*" preCondition="integratedMode" verb="*" path="ReportExportResource.axd" type="DevExpress.ExpressApp.Reports.Web.ReportExportHttpHandler, DevExpress.ExpressApp.Reports.Web.v13.2, Version=13.2.5.0, culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
</code></pre>

<ul>
<li>  <add name="Glimpse" path="glimpse.axd" verb="GET" type="Glimpse.AspNet.HttpHandler, Glimpse.AspNet" preCondition="integratedMode" />
</handlers>
<validation validateIntegratedModeConfiguration="false" />
<modules>
  <add name="ASPxHttpHandlerModule" type="DevExpress.Web.ASPxClasses.ASPxHttpHandlerModule, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /></li>
<li>  <add name="Glimpse" type="Glimpse.AspNet.HttpModule, Glimpse.AspNet" preCondition="integratedMode" />
</modules>
&lt;/system.webServer>
```</li>
</ul>


<p>NuGet added some incorrect definitions to <code>system.web</code>. Make sure to restore this section to the DevExpress default:</p>

<p>```xml
  &lt;system.web></p>

<pre><code>&lt;httpRuntime requestValidationMode="2.0" /&gt;
&lt;sessionState mode="InProc" timeout="2" /&gt;
&lt;httpHandlers configSource="HttpHandlers.Web.Config" /&gt;
&lt;httpModules configSource="HttpModules.Web.Config" /&gt;
</code></pre>

<p>```</p>

<p>And now we'll add the corrected changes to <code>HttpHandlers.Web.Config</code> and <code>HttpModule.Web.Config</code></p>

<p><code>diff HttpHandlers.Web.Config
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;httpHandlers&gt;
+ &lt;add verb="GET" path="glimpse.axd" type="Glimpse.AspNet.HttpHandler, Glimpse.AspNet" /&gt;
  &lt;add verb="*" path="TestControls.axd" type="DevExpress.ExpressApp.Web.TestScripts.TestScriptsManager, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add verb="*" path="ImageResource.axd" type="DevExpress.ExpressApp.Web.ImageResourceHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add verb="*" path="SessionKeepAliveReconnect.aspx*" type="DevExpress.ExpressApp.Web.SessionKeepAliveReconnectHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add verb="*" path="*.aspx" type="DevExpress.ExpressApp.Web.WebWindowTemplateHttpHandler, DevExpress.ExpressApp.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add verb="GET,POST" path="ASPxUploadProgressHandlerPage.ashx" validate="false" type="DevExpress.Web.ASPxUploadControl.ASPxUploadProgressHttpHandler, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
  &lt;add verb="*" path="ReportExportResource.axd" type="DevExpress.ExpressApp.Reports.Web.ReportExportHttpHandler, DevExpress.ExpressApp.Reports.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
&lt;/httpHandlers&gt;
</code></p>

<p><code>xml HttpModules.Web.Config
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;httpModules&gt;
+ &lt;add name="Glimpse" type="Glimpse.AspNet.HttpModule, Glimpse.AspNet" /&gt;
  &lt;add name="ASPxHttpHandlerModule" type="DevExpress.Web.ASPxClasses.ASPxHttpHandlerModule, DevExpress.Web.v13.2, Version=13.2.5.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" /&gt;
&lt;/httpModules&gt;
</code></p>

<p>Next, there is <a href="https://github.com/Glimpse/Glimpse/issues/632">an outstanding problem</a> with the current release version of the Glimpse ASP.NET NuGet package (1.6.0) which prevents it from working with the development webserver. (Apparently it's fixed in 1.7.0 which should be released soon). If you try to run MainDemo.Web you will get the following error:</p>

<pre><code>Type 'System.Web.HttpContextWrapper' in assembly 'System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' is not marked as serializable.
</code></pre>

<p>However it works fine against IIS Express (or full IIS). Go to the MainDemo.Web and change the debug properties as follows:</p>

<p><img src="/images/blog/xaf-with-glimpse-015.png"></p>

<p>Then run the web application. Glimpse is off by default. In order to turn it on, you need to set a cookie, which you can do by navigating to <code>Glimpse.axd</code>. This is the Glimpse configuration screen.</p>

<p><img src="/images/blog/xaf-with-glimpse-014.png"></p>

<h2>Additional Glimpse extensions</h2>

<p>Glimpse is extensible and there are <a href="http://getglimpse.com/Packages">many additional plugins</a> available. Many of these take the form of additional tabs with details about a particular aspect of your application: SQL Queries, Elmah errors, ASP.NET caching, logging, dependency injection, <em>etc.</em></p>

<h2>MainDemo Sample Project</h2>

<p>I have uploaded a modified XAF MainDemo to this <a href="https://github.com/ZeroSharp/Xaf_MainDemo_Glimpse">GitHub repository</a> with all the above changes. (Don't forget to debug against IIS Express).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DevExpress 13.2 Review - Part 2]]></title>
    <link href="http://ZeroSharp.github.com/devexpress-13-dot-2-review-part-2/"/>
    <updated>2013-12-10T16:10:00+00:00</updated>
    <id>http://ZeroSharp.github.com/devexpress-13-dot-2-review-part-2</id>
    <content type="html"><![CDATA[<p>This is the second part of a review of the new DevExpress 13.2. In <a href="/devexpress-13-dot-2-review-part-1">the last part</a> we looked in-depth at the new <a href="https://community.devexpress.com/blogs/eaf/archive/2013/11/08/easy-large-reports-in-13-2-ctp-of-reportsv2-module.aspx">Reports V2</a>. In this part I'll go over some of the other new features including the support for warnings and confirmations in the validation module.</p>

<h2>Soft Validation Rules</h2>

<p>With 13.2, DevExpress adds support for warning/confirmation messages to the validation engine. Warnings can be used to handle an unusual but valid data entry. An example would be:</p>

<p><blockquote><p>The date of birth results in an age of over 100. Are you sure?</p></blockquote></p>

<p>Here the age of the contact is unusual but not impossible, so instead of prohibiting it entirely, we ask the user for confirmation before saving.</p>

<p>Let's add this rule to the MainDemo. Open the model and navigate to the Validation node. Add a <code>RuleValueComparison</code> and configure it as follows</p>

<p><img src="/images/blog/devexpress-13-2-review-010.png"></p>

<p>Of course you could instead also define the same rule with an attribute on the <code>Birthday</code> property. Something like:</p>

<p>```c#
[RuleValueComparison("IsOlderThan100_Warning",</p>

<pre><code>DefaultContexts.Save,
ValueComparisonType.GreaterThan, "AddYears(Now(), -100)",
"Birthday makes this Contact older than 100. Are you sure?",
ParametersMode.Expression,
ResultType = ValidationResultType.Warning)]
</code></pre>

<p>```</p>

<p>Notice the new <code>ResultType</code> parameter is set to <code>ValidationResultType.Warning</code>.</p>

<p>Another typical use is to provide better handling of duplicates. Consider the following:</p>

<p>```c#
[RuleCombinationOfPropertiesIsUnique("DuplicateName_Warning",</p>

<pre><code>DefaultContexts.Save, 
"LastName;FirstName", 
"There is already a Contact with the name {FullName}. Are you sure?", 
ResultType = ValidationResultType.Warning)]
</code></pre>

<p>public class Contact : Person {
  //etc ...
```</p>

<p>And then this is what happens if I try to add another John Nilsen.</p>

<p><img src="/images/blog/devexpress-13-2-review-011.png"></p>

<p>Another scenario would be to warn the user of something which needs attention. Such as "Warning! You are running out of funds in your current account." Or "Warning! Deleting this record will format your hard drive."</p>

<h3>List Views</h3>

<p>Soft validation also works in the list views, even with multiple selection, but there are a couple of things that don't work very smoothly yet and I would expect the web implementation to evolve over the coming releases.</p>

<p>In order to demonstrate this I need to use a context which allows multiple selection such as deletion. So let's decorate our class with the following simple rule.</p>

<p>```c#</p>

<pre><code>[RuleCriteria("Deletion_Warning", DefaultContexts.Delete, "1=0", "Warning! Are you sure?", ResultType = ValidationResultType.Warning)]
</code></pre>

<p>```</p>

<p>Then I select all the contacts and press <code>Delete</code>, after the confirmation window, I get this:</p>

<p><img src="/images/blog/devexpress-13-2-review-014.png"></p>

<h3>Web Application</h3>

<p>Soft validation is also available in the web application. This is what a warning looks like.</p>

<p><img src="/images/blog/devexpress-13-2-review-015.png"></p>

<p>I would prefer to see a <em>Confirm</em> button rather than the current <em>Ignore</em> checkbox since a button requires a single click to validate.</p>

<p>When there are several warnings and errors at the same time, the current implementation displays them all. I think it would be preferable if warnings were not displayed unless there are no errors. Unless DevExpress provide this as an option soon, I will attempt to extend the controller in this regard in a future post.</p>

<h2>Other new features</h2>

<p>In the 13.2 release, there is now support for runtime extension of the model. DevExpress is calling this feature <em>custom fields</em> and (again) it is marked as beta. This is not a feature I've looked at, but there are a few other non-XAF DevExpress novelties which I'd like to see working within XAF. These include <a href="https://www.devexpress.com/Subscriptions/New-2013-v2-Beta.xml?product=aspnet#ctl00_ctl00_Content_Content_ctl659">new themes</a> and <a href="https://www.devexpress.com/Subscriptions/New-2013-v2-Beta.xml?product=aspnet#ctl00_ctl00_Content_Content_ctl660">support for grid batch editing</a>.</p>

<h2>One warning</h2>

<p><img class="left" src="/images/blog/devexpress-13-2-review-001.png">
<img class="right" src="/images/blog/devexpress-13-2-review-002.png">
The default directories for the installation have changed again. I'm sure DevExpress has some good reason for this, but if, like me, you have several different versions installed you end up with a confusing directory tree. Whenever this happens I always end up having to modify build scripts and config files so that all my tools work as expected. For those of you who use Red Gate's <em>.NET Reflector</em>, you can find my config file <a href="https://gist.github.com/shamp00/7748150">in this gist</a>.</p>

<h2>Conclusions</h2>

<p>For the 13.2 release, DevExpress have focused on making the existing functionality work better rather than developing new modules.</p>

<p>Better reports. Better validation. A better framework all round.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DevExpress 13.2 Review - Part 1]]></title>
    <link href="http://ZeroSharp.github.com/devexpress-13-dot-2-review-part-1/"/>
    <updated>2013-12-02T16:23:00+00:00</updated>
    <id>http://ZeroSharp.github.com/devexpress-13-dot-2-review-part-1</id>
    <content type="html"><![CDATA[<p>The first version of XAF I ever installed was called <em>eXpressApp-1.0.CTP2.exe</em> in July 2006! It has certainly come a long way since then.</p>

<p>This post is the first part of an overview of the brand new version XAF 13.2 which will be released any day now. This part is an in-depth review of the new report writer features (still in beta).</p>

<h2>Reports V2</h2>

<p>Prior to this version, XAF reports were not source code. They were objects serialized to a file and then loaded into the database during initialisation. This has a lot of shortcomings some of which I have addressed in previous <a href="/making-xaf-reports-even-better-part-1/">blog posts</a>.</p>

<p>But now finally it is now possible to build XAF reports directly from Visual Studio. DevExpress is calling this <a href="https://community.devexpress.com/blogs/eaf/archive/2013/11/08/easy-large-reports-in-13-2-ctp-of-reportsv2-module.aspx">Reports V2</a> and it largely supersedes my previous workarounds. The immediate advantages of Reports V2 are:</p>

<ul>
<li>Build time syntax checking</li>
<li>Easily merge/compare report versions</li>
<li>Painless version control of reports</li>
<li>Better unit testing possibilities</li>
</ul>


<p>Let's have a look at the details. DevExpress have provided us with a new sample project called <em>ReportsV2Demo</em>. The interesting part of the project solution is here:</p>

<p><img src="/images/blog/devexpress-13-2-review-003.png"></p>

<p>Notice that there are two folders containing reports. <em>PredefinedEditableReports</em> contains V1 reports. That is, the report is serialised as a string and loaded into the database during initialisation. If we look at the source for one of these, here is what it looks like:</p>

<p>```c#
namespace ReportV2Demo.Module.PredefinedEditableReports {</p>

<pre><code>public class OrdinalReportResource {
    public static string ReportLayout = @"
</code></pre>

<p>/// <XRTypeInfo>
///   <AssemblyFullName>DevExpress.XtraReportsVSuffix, Version=dllVersion, Culture=neutral, PublicKeyToken=dllPublicKeyToken</AssemblyFullName>
///   <AssemblyLocation>C:\Windows\Microsoft.Net\assembly\GAC_MSIL\DevExpress.XtraReportsVSuffix\v4.0_dllVersion__dllPublicKeyToken\DevExpress.XtraReportsVSuffix.dll</AssemblyLocation>
///   <TypeName>DevExpress.XtraReports.UI.XtraReport</TypeName>
///   <Localization>en-US</Localization>
///   <Version>VersionShort</Version>
///   <References>
///     <Reference Path=""C:\Windows\Microsoft.Net\assembly\GAC_MSIL\DevExpress.Persistent.BaseVSuffix\v4.0_dllVersion__dllPublicKeyToken\DevExpress.Persistent.BaseVSuffix.dll"" />
///     <Reference Path=""C:\Windows\Microsoft.Net\assembly\GAC_MSIL\System\v4.0_4.0.0.0__b77a5c561934e089\System.dll"" /></p>

<p>/// etc.
```
The second folder, <em>PredefinedReadonlyReports</em> contains the V2 reports. With these reports, we can right-click and <strong>View Designer</strong> and up pops the XtraReport designer.</p>

<p><img src="/images/blog/devexpress-13-2-review-004.png"></p>

<p>Now I can make changes to my report within Visual Studio. In theory I can preview the report and view the HTML output. However, in the beta (13.2.4) the Preview view prints the report correctly but fails to fetch any data so all the fields are empty (maybe this is by design).</p>

<p>(Actually, I think the names of these folders could be improved. Maybe XafReports vs. XtraReports. Or RuntimeReports vs. DesigntimeReports.)</p>

<p>With respect to event scripts which in the past were particularly arduous to maintain, we now have two options.</p>

<h3>Scripts option 1 - Use serialized scripts</h3>

<p> Firstly, you can continue to use the scripts as before. You can use Visual Studio's <em>Properties</em> window to navigate to the script you need and then add the necessary code in the custom editor.</p>

<p><img src="/images/blog/devexpress-13-2-review-005.png"></p>

<p>Unfortunately, this is not the best from a maintenance perspective. The Scripts code editor view is not at all comparable to Visual Studio. No Intellisense. No CodeRush. In addition, the script itself gets serialized to a string.</p>

<p>```c#
this.ScriptsSource = "\r\nprivate void xrLabel2_BeforePrint(object sender,System.Drawing.Printing.PrintE" +</p>

<pre><code>"ventArgs e) {\r\n    string something = \"something\";\r\n}\r\n";
</code></pre>

<p>```
So unfortunately this approach does not improve things much with regard to compile-time syntax checking or code merging/version control.</p>

<h3>Scripts option 2 - Move the scripts to the C# file</h3>

<p>Now that the report is more like an <code>XtraReport</code>, we can attach an event in code. To test it I'll replace the output of the <em>First name</em> with the current time.</p>

<p>```c#
public partial class XtraReportOrdinary : DevExpress.XtraReports.UI.XtraReport
{</p>

<pre><code>public XtraReportOrdinary()
{
    InitializeComponent();
    xrLabel2.BeforePrint += xrLabel2_BeforePrint;
}

private void xrLabel2_BeforePrint(object sender, System.Drawing.Printing.PrintEventArgs e)
{
    // Today's date and time
    xrLabel2.Text = DateTime.Now.ToString("G");
}
</code></pre>

<p>}
```</p>

<p>Now let's see if it works. We start up the web application and run the report.</p>

<p><img src="/images/blog/devexpress-13-2-review-006.png"></p>

<p>Excellent! You can see the report has successfully run the event and is displaying the current time instead of the first name. Here are the advantages of handling events this way.</p>

<ul>
<li>If there's a mistake in an event, the project will not compile until it's fixed.</li>
<li>The code is more readable.</li>
<li>The source code of the events can easily be compared with older versions.</li>
<li>The source code can be merged much more easily when handling version control conflicts.</li>
<li>Unit testing of the events becomes feasible.</li>
</ul>


<h3>Runtime tailoring</h3>

<p>Can an end-user still make a copy and tailor the report as they could with the older versions? Yes they can! Let's start up the WinForms client and have a look.</p>

<p><img src="/images/blog/devexpress-13-2-review-007.png"></p>

<p>Each of the <em>PredefinedReadonlyReports</em> has a new option <em>Copy predefined report</em>. Also, notice that the <em>Show Report Designer</em> is greyed out. Now compare with the copy.</p>

<p><img src="/images/blog/devexpress-13-2-review-008.png"></p>

<p>This time it is the <em>Copy predefined report</em> is greyed out and the familiar <em>Show Report Designer</em> has become available. (A little suggestion to the DevExpress crew. It would be better if the new copy got renamed to <em>Copy of Inplace Report</em> like Windows does when copying a file). Now we can open the Report Designer and customise the report further. Fantastic!</p>

<p>Let's check what happened to our events?</p>

<p><img src="/images/blog/devexpress-13-2-review-009.png"></p>

<p>Well, the serialized event was copied correctly, but the script that we put in the C# file has not been copied. A bit unfortunate - that event would have to be re-written or copied manually from the C# source file, but in most cases, additional tailoring of reports is a one-off occasional activity. For me at least, the benefits of having more maintainable code outweigh the inconvenience of losing the events when cloning a report.</p>

<h2>Conclusions</h2>

<p>Reports V2 is certainly the most significant improvement to the XAF reporting engine yet. I'm sure there are a few beta issues to iron out and a few further improvements down the line. In this post, I haven't looked at features such as views, sub-reports and custom reporting components, all of which deserve further investigation.</p>

<p>In my <a href="http://www.coprocess.com/">main development project</a>, there are currently 110 different reports and maintaining them takes some effort. Reports V2 will help considerably. Hats off to the DevExpress team.</p>

<h2>Next up</h2>

<p>In my next post I'll be taking a look at the new soft validation along with some other 13.2 improvements.</p>
]]></content>
  </entry>
  
</feed>
